<html>
   <head>
      <title>JavaScript MQTT WebSocket Example</title>
	  <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.js" type="text/javascript">
	 </script>
	 <script type = "text/javascript" language = "javascript">
		var mqtt;
		var reconnectTimeout = 2000;
		var host="mqtt.iot.atria.edu"; //change this
		var port=9001;

		function onMessageArrived(msg){
			out_msg="Message received "+msg.payloadString+"<br>";
			out_msg=out_msg+"Message received Topic "+msg.destinationName;
			console.log(out_msg);

			const message = JSON.parse(msg.payloadString);
			console.log(message.IR1.toString());
			document.getElementById("spot1").innerHTML = message.ultrasonic_cm.toString();
			if(message.ultrasonic_cm<10){
			document.getElementById("spot1").style.backgroundColor = "red"; }
			else {
			document.getElementById("spot1").style.backgroundColor = "green"; }
			
			
			document.getElementById("spot2").innerHTML = message.IR1.toString();
			if(message.IR1==true){
			document.getElementById("spot2").style.backgroundColor = "red"; }
			else {
			document.getElementById("spot2").style.backgroundColor = "green"; }
		}
		
	 	function onConnect() {
	  // Once a connection has been made, make a subscription and send a message.
	
		console.log("Connected ");
		mqtt.subscribe("parkpro");
		message = new Paho.MQTT.Message("Hello World");
		message.destinationName = "sensor1";
		mqtt.send(message);
	  }
	  function MQTTconnect() {
		console.log("connecting to "+ host +" "+ port);
		mqtt = new Paho.MQTT.Client(host,port,"clientjs");
		//document.write("connecting to "+ host);
		var options = {
			timeout: 3,
			onSuccess: onConnect,
		  
		 };
		mqtt.onMessageArrived = onMessageArrived;
		mqtt.connect(options); //connect
		}
	 
	  </script>
   </head>
     <body>
   <h1 style="text-align: center;">Park Pro</h1>

   <table width=100%; style="text-align:center">
	   <tr>
		   <th>Spot</th>
		   <th>Status</th>
	   </tr>
	   <tr>
		<td>1</td>
		<td id="spot1"></td>
	</tr>
	<tr>
		<td>2</td>
		<td id="spot2"></td>
	</tr>
	<tr>
		<td>3</td>
		<td id="spot3"></td>
	</tr>
	<tr>
		<td>4</td>
		<td id="spot4"></td>
	</tr>
   </table>
 	<script>
	MQTTconnect();
	</script>
   </body>	
</html>